<!DOCTYPE html>
<html>
<head>
    <title>TubeArchivist Metadata</title>
</head>
<body>
    <div data-role="page" class="page type-interior pluginConfigurationPage tubeArchivistConfigurationPage" data-require="emby-input,emby-button,emby-select,emby-checkbox">
        <div data-role="content">
            <div class="content-primary">
                <form class="tubeArchivistConfigurationForm">
                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtTubeArchivistUrl">TubeArchivist URL:</label>
                        <input is="emby-input" type="text" id="txtTubeArchivistUrl" name="tubeArchivistUrl" />
                        <div class="fieldDescription">The URL of your TubeArchivist instance (e.g., http://localhost:8000)</div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtApiKey">API Key:</label>
                        <input is="emby-input" type="password" id="txtApiKey" name="apiKey" />
                        <div class="fieldDescription">Your TubeArchivist API key from the settings page</div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtCollectionDisplayName">Collection Display Name:</label>
                        <input is="emby-input" type="text" id="txtCollectionDisplayName" name="collectionDisplayName" />
                        <div class="fieldDescription">The name to display for the TubeArchivist collection</div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtChannelOverviewLength">Channel Overview Length:</label>
                        <input is="emby-input" type="number" id="txtChannelOverviewLength" name="channelOverviewLength" min="50" max="2000" />
                        <div class="fieldDescription">Maximum characters for channel descriptions (50-2000)</div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtVideoOverviewLength">Video Overview Length:</label>
                        <input is="emby-input" type="number" id="txtVideoOverviewLength" name="videoOverviewLength" min="50" max="2000" />
                        <div class="fieldDescription">Maximum characters for video descriptions (50-2000)</div>
                    </div>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label>
                            <input is="emby-checkbox" type="checkbox" id="chkSyncFromEmby" />
                            <span>Sync from Emby to TubeArchivist</span>
                        </label>
                        <div class="fieldDescription">Enable to sync watch progress from Emby to TubeArchivist</div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtEmbyToTubeArchivistUsers">Emby to TubeArchivist Users:</label>
                        <input is="emby-input" type="text" id="txtEmbyToTubeArchivistUsers" name="embyToTubeArchivistUsers" />
                        <div class="fieldDescription">Username to sync (leave empty to disable)</div>
                    </div>

                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label>
                            <input is="emby-checkbox" type="checkbox" id="chkSyncFromTubeArchivist" />
                            <span>Sync from TubeArchivist to Emby</span>
                        </label>
                        <div class="fieldDescription">Enable to sync watch progress from TubeArchivist to Emby</div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtTubeArchivistToEmbyUsers">TubeArchivist to Emby Users:</label>
                        <input is="emby-input" type="text" id="txtTubeArchivistToEmbyUsers" name="tubeArchivistToEmbyUsers" />
                        <div class="fieldDescription">Comma-separated usernames to sync</div>
                    </div>

                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="txtSyncInterval">Sync Interval (seconds):</label>
                        <input is="emby-input" type="number" id="txtSyncInterval" name="syncInterval" min="30" max="3600" />
                        <div class="fieldDescription">How often to sync in seconds (30-3600)</div>
                    </div>

                    <div>
                        <button is="emby-button" type="submit" class="raised button-submit block">
                            <span>Save</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script type="text/javascript">
            $('.tubeArchivistConfigurationPage').on('pageshow', function () {
                var page = this;
                
                ApiClient.getPluginConfiguration('A8B5B444-8C8D-4F2A-9B1C-3D4E5F6A7B8C').then(function (config) {
                    $('#txtTubeArchivistUrl', page).val(config.TubeArchivistUrl || 'http://localhost:8000');
                    $('#txtApiKey', page).val(config.ApiKey || '');
                    $('#txtCollectionDisplayName', page).val(config.CollectionDisplayName || 'TubeArchivist');
                    $('#txtChannelOverviewLength', page).val(config.ChannelOverviewLength || 1000);
                    $('#txtVideoOverviewLength', page).val(config.VideoOverviewLength || 1000);
                    $('#chkSyncFromEmby', page).checked(config.SyncFromEmby || false);
                    $('#txtEmbyToTubeArchivistUsers', page).val(config.EmbyToTubeArchivistUsers || '');
                    $('#chkSyncFromTubeArchivist', page).checked(config.SyncFromTubeArchivist || false);
                    $('#txtTubeArchivistToEmbyUsers', page).val(config.TubeArchivistToEmbyUsers || '');
                    $('#txtSyncInterval', page).val(config.SyncInterval || 300);
                });
            });

            $('.tubeArchivistConfigurationForm').on('submit', function (e) {
                Dashboard.showLoadingMsg();

                var form = this;

                ApiClient.getPluginConfiguration('A8B5B444-8C8D-4F2A-9B1C-3D4E5F6A7B8C').then(function (config) {
                    config.TubeArchivistUrl = $('#txtTubeArchivistUrl', form).val();
                    config.ApiKey = $('#txtApiKey', form).val();
                    config.CollectionDisplayName = $('#txtCollectionDisplayName', form).val();
                    config.ChannelOverviewLength = parseInt($('#txtChannelOverviewLength', form).val()) || 1000;
                    config.VideoOverviewLength = parseInt($('#txtVideoOverviewLength', form).val()) || 1000;
                    config.SyncFromEmby = $('#chkSyncFromEmby', form).checked();
                    config.EmbyToTubeArchivistUsers = $('#txtEmbyToTubeArchivistUsers', form).val();
                    config.SyncFromTubeArchivist = $('#chkSyncFromTubeArchivist', form).checked();
                    config.TubeArchivistToEmbyUsers = $('#txtTubeArchivistToEmbyUsers', form).val();
                    config.SyncInterval = parseInt($('#txtSyncInterval', form).val()) || 300;

                    ApiClient.updatePluginConfiguration('A8B5B444-8C8D-4F2A-9B1C-3D4E5F6A7B8C', config).then(Dashboard.processPluginConfigurationUpdateResult);
                });

                return false;
            });
        </script>
    </div>
</body>
</html>
